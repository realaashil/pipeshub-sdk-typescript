/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import { expect, test } from "vitest";
import { Pipeshub } from "../index.js";
import { createTestHTTPClient } from "./test-client.js";

test("Openid Connect Oauth User Info", async () => {
  const testHttpClient = createTestHTTPClient("oauthUserInfo");

  const pipeshub = new Pipeshub({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    security: {
      bearerAuth: "<YOUR_BEARER_TOKEN_HERE>",
    },
  });

  const result = await pipeshub.openIDConnect.oauthUserInfo();
  expect(result).toBeDefined();
  expect(result).toEqual({
    userId: "<id>",
  });
});

test("Openid Connect Openid Configuration", async () => {
  const testHttpClient = createTestHTTPClient("openidConfiguration");

  const pipeshub = new Pipeshub({
    httpClient: testHttpClient,
  });

  const result = await pipeshub.openIDConnect.openidConfiguration({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    scopesSupported: [
      "openid",
      "profile",
      "email",
      "read:records",
      "write:records",
    ],
    responseTypesSupported: [
      "code",
    ],
    grantTypesSupported: [
      "authorization_code",
      "client_credentials",
      "refresh_token",
    ],
    tokenEndpointAuthMethodsSupported: [
      "client_secret_basic",
      "client_secret_post",
    ],
    subjectTypesSupported: [
      "public",
    ],
    idTokenSigningAlgValuesSupported: [
      "HS256",
      "RS256",
    ],
    claimsSupported: [
      "user_id",
      "iss",
      "aud",
      "exp",
      "iat",
      "email",
      "name",
    ],
    codeChallengeMethodsSupported: [
      "S256",
      "plain",
    ],
  });
});

test("Openid Connect Jwks", async () => {
  const testHttpClient = createTestHTTPClient("jwks");

  const pipeshub = new Pipeshub({
    httpClient: testHttpClient,
  });

  const result = await pipeshub.openIDConnect.jwks({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    keys: [
      {
        kty: "RSA",
        use: "sig",
        alg: "RS256",
        e: "AQAB",
      },
    ],
  });
});
