/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import { expect, test } from "vitest";
import { Pipeshub } from "../index.js";
import { filesToByteArray, streamToByteArray } from "./files.js";
import { createTestHTTPClient } from "./test-client.js";

test("Records Get All Records", async () => {
  const testHttpClient = createTestHTTPClient("getAllRecords");

  const pipeshub = new Pipeshub({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    security: {
      bearerAuth: "<YOUR_BEARER_TOKEN_HERE>",
    },
  });

  const result = await pipeshub.records.getAllRecords({
    recordTypes: "FILE,WEBPAGE,EMAIL",
    connectors: "GOOGLE_DRIVE,ONEDRIVE",
    indexingStatus: "COMPLETED,FAILED",
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    records: [
      {
        id: "550e8400-e29b-41d4-a716-446655440000",
        recordName: "Q4 Financial Report.pdf",
        externalRecordId: "507f1f77bcf86cd799439011",
        recordType: "FILE",
        origin: "UPLOAD",
        connectorId: "conn_123456",
        connectorName: "GOOGLE_DRIVE",
        orgId: "org_abc123",
        kbId: "kb_xyz789",
        folderId: "folder_456",
        version: 3,
        createdAtTimestamp: 1704153600000,
        updatedAtTimestamp: 1704240000000,
        indexingStatus: "COMPLETED",
        isDeleted: false,
        isArchived: false,
        webUrl: "https://drive.google.com/file/d/abc123",
        mimeType: "application/pdf",
        sizeInBytes: 1048576,
        extension: "pdf",
        type: "record",
        ticketRecord: {},
      },
    ],
  });
});

test("Records Get Kb Records", async () => {
  const testHttpClient = createTestHTTPClient("getKBRecords");

  const pipeshub = new Pipeshub({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    security: {
      bearerAuth: "<YOUR_BEARER_TOKEN_HERE>",
    },
  });

  const result = await pipeshub.records.getKBRecords({
    kbId: "<id>",
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    records: [
      {
        id: "550e8400-e29b-41d4-a716-446655440000",
        recordName: "Q4 Financial Report.pdf",
        externalRecordId: "507f1f77bcf86cd799439011",
        recordType: "FILE",
        origin: "UPLOAD",
        connectorId: "conn_123456",
        connectorName: "GOOGLE_DRIVE",
        orgId: "org_abc123",
        kbId: "kb_xyz789",
        folderId: "folder_456",
        version: 3,
        createdAtTimestamp: 1704153600000,
        updatedAtTimestamp: 1704240000000,
        indexingStatus: "COMPLETED",
        isDeleted: false,
        isArchived: false,
        webUrl: "https://drive.google.com/file/d/abc123",
        mimeType: "application/pdf",
        sizeInBytes: 1048576,
        extension: "pdf",
        type: "record",
        ticketRecord: {},
      },
    ],
  });
});

test("Records Get Kb Children", async () => {
  const testHttpClient = createTestHTTPClient("getKBChildren");

  const pipeshub = new Pipeshub({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    security: {
      bearerAuth: "<YOUR_BEARER_TOKEN_HERE>",
    },
  });

  const result = await pipeshub.records.getKBChildren({
    kbId: "<id>",
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    records: [
      {
        id: "550e8400-e29b-41d4-a716-446655440000",
        recordName: "Q4 Financial Report.pdf",
        externalRecordId: "507f1f77bcf86cd799439011",
        recordType: "FILE",
        origin: "UPLOAD",
        connectorId: "conn_123456",
        connectorName: "GOOGLE_DRIVE",
        orgId: "org_abc123",
        kbId: "kb_xyz789",
        folderId: "folder_456",
        version: 3,
        createdAtTimestamp: 1704153600000,
        updatedAtTimestamp: 1704240000000,
        indexingStatus: "COMPLETED",
        isDeleted: false,
        isArchived: false,
        webUrl: "https://drive.google.com/file/d/abc123",
        mimeType: "application/pdf",
        sizeInBytes: 1048576,
        extension: "pdf",
        type: "record",
        ticketRecord: {},
      },
    ],
  });
});

test("Records Get Record By Id", async () => {
  const testHttpClient = createTestHTTPClient("getRecordById");

  const pipeshub = new Pipeshub({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    security: {
      bearerAuth: "<YOUR_BEARER_TOKEN_HERE>",
    },
  });

  const result = await pipeshub.records.getRecordById({
    recordId: "<id>",
    convertTo: "txt",
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    record: {
      id: "550e8400-e29b-41d4-a716-446655440000",
      recordName: "Q4 Financial Report.pdf",
      externalRecordId: "507f1f77bcf86cd799439011",
      recordType: "FILE",
      origin: "UPLOAD",
      connectorId: "conn_123456",
      connectorName: "GOOGLE_DRIVE",
      orgId: "org_abc123",
      kbId: "kb_xyz789",
      folderId: "folder_456",
      version: 3,
      createdAtTimestamp: 1704153600000,
      updatedAtTimestamp: 1704240000000,
      indexingStatus: "COMPLETED",
      isDeleted: false,
      isArchived: false,
      webUrl: "https://drive.google.com/file/d/abc123",
      mimeType: "application/pdf",
      sizeInBytes: 1048576,
      extension: "pdf",
      type: "record",
      ticketRecord: {},
    },
  });
});

test("Records Update Record", async () => {
  const testHttpClient = createTestHTTPClient("updateRecord");

  const pipeshub = new Pipeshub({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    security: {
      bearerAuth: "<YOUR_BEARER_TOKEN_HERE>",
    },
  });

  const result = await pipeshub.records.updateRecord({
    recordId: "<id>",
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    record: {
      id: "550e8400-e29b-41d4-a716-446655440000",
      recordName: "Q4 Financial Report.pdf",
      externalRecordId: "507f1f77bcf86cd799439011",
      recordType: "FILE",
      origin: "UPLOAD",
      connectorId: "conn_123456",
      connectorName: "GOOGLE_DRIVE",
      orgId: "org_abc123",
      kbId: "kb_xyz789",
      folderId: "folder_456",
      version: 3,
      createdAtTimestamp: 1704153600000,
      updatedAtTimestamp: 1704240000000,
      indexingStatus: "COMPLETED",
      isDeleted: false,
      isArchived: false,
      webUrl: "https://drive.google.com/file/d/abc123",
      mimeType: "application/pdf",
      sizeInBytes: 1048576,
      extension: "pdf",
      type: "record",
      ticketRecord: {},
    },
  });
});

test("Records Stream Record Buffer", async () => {
  const testHttpClient = createTestHTTPClient("streamRecordBuffer");

  const pipeshub = new Pipeshub({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    security: {
      bearerAuth: "<YOUR_BEARER_TOKEN_HERE>",
    },
  });

  const result = await pipeshub.records.streamRecordBuffer({
    recordId: "<id>",
  });
  expect(result).toBeDefined();
  expect(new Uint8Array(await streamToByteArray(result))).toEqual(
    await filesToByteArray(".speakeasy/testfiles/example.file"),
  );
});
