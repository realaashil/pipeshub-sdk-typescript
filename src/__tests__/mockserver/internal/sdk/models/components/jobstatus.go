// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package components

import (
	"encoding/json"
	"errors"
	"fmt"
	"mockserver/internal/sdk/optionalnullable"
	"mockserver/internal/sdk/utils"
)

// Progress - Detailed progress object
type Progress struct {
	Percentage *float64 `json:"percentage,omitempty"`
	// Current items processed
	Current *int64 `json:"current,omitempty"`
	// Total items to process
	Total *int64 `json:"total,omitempty"`
}

func (p Progress) MarshalJSON() ([]byte, error) {
	return utils.MarshalJSON(p, "", false)
}

func (p *Progress) UnmarshalJSON(data []byte) error {
	if err := utils.UnmarshalJSON(data, &p, "", false, nil); err != nil {
		return err
	}
	return nil
}

func (o *Progress) GetPercentage() *float64 {
	if o == nil {
		return nil
	}
	return o.Percentage
}

func (o *Progress) GetCurrent() *int64 {
	if o == nil {
		return nil
	}
	return o.Current
}

func (o *Progress) GetTotal() *int64 {
	if o == nil {
		return nil
	}
	return o.Total
}

type ProgressUnionType string

const (
	ProgressUnionTypeNumber   ProgressUnionType = "number"
	ProgressUnionTypeProgress ProgressUnionType = "progress"
)

// ProgressUnion - Job progress information (can be number 0-100 or object with percentage/current/total)
type ProgressUnion struct {
	Number   *float64  `queryParam:"inline"`
	Progress *Progress `queryParam:"inline"`

	Type ProgressUnionType
}

func CreateProgressUnionNumber(number float64) ProgressUnion {
	typ := ProgressUnionTypeNumber

	return ProgressUnion{
		Number: &number,
		Type:   typ,
	}
}

func CreateProgressUnionProgress(progress Progress) ProgressUnion {
	typ := ProgressUnionTypeProgress

	return ProgressUnion{
		Progress: &progress,
		Type:     typ,
	}
}

func (u *ProgressUnion) UnmarshalJSON(data []byte) error {

	var number float64 = float64(0)
	if err := utils.UnmarshalJSON(data, &number, "", true, nil); err == nil {
		u.Number = &number
		u.Type = ProgressUnionTypeNumber
		return nil
	}

	var progress Progress = Progress{}
	if err := utils.UnmarshalJSON(data, &progress, "", true, nil); err == nil {
		u.Progress = &progress
		u.Type = ProgressUnionTypeProgress
		return nil
	}

	return fmt.Errorf("could not unmarshal `%s` into any supported union types for ProgressUnion", string(data))
}

func (u ProgressUnion) MarshalJSON() ([]byte, error) {
	if u.Number != nil {
		return utils.MarshalJSON(u.Number, "", true)
	}

	if u.Progress != nil {
		return utils.MarshalJSON(u.Progress, "", true)
	}

	return nil, errors.New("could not marshal union type ProgressUnion: all fields are null")
}

// State - Current state of the job in the queue:<br>
// <ul>
// <li><b>waiting</b>: Queued and waiting to be processed</li>
// <li><b>active</b>: Currently being processed by a worker</li>
// <li><b>completed</b>: Successfully finished</li>
// <li><b>failed</b>: Failed after all retry attempts</li>
// <li><b>delayed</b>: Scheduled to run at a future time</li>
// <li><b>paused</b>: Manually paused by user</li>
// <li><b>stuck</b>: Job is stuck (worker crashed mid-processing)</li>
// </ul>
type State string

const (
	StateWaiting   State = "waiting"
	StateActive    State = "active"
	StateCompleted State = "completed"
	StateFailed    State = "failed"
	StateDelayed   State = "delayed"
	StatePaused    State = "paused"
	StateStuck     State = "stuck"
)

func (e State) ToPointer() *State {
	return &e
}
func (e *State) UnmarshalJSON(data []byte) error {
	var v string
	if err := json.Unmarshal(data, &v); err != nil {
		return err
	}
	switch v {
	case "waiting":
		fallthrough
	case "active":
		fallthrough
	case "completed":
		fallthrough
	case "failed":
		fallthrough
	case "delayed":
		fallthrough
	case "paused":
		fallthrough
	case "stuck":
		*e = State(v)
		return nil
	default:
		return fmt.Errorf("invalid value for State: %v", v)
	}
}

// JobStatus - Complete status information for a crawling job
type JobStatus struct {
	// Unique job ID assigned by BullMQ
	ID optionalnullable.OptionalNullable[string] `json:"id,omitempty"`
	// Job name (format crawl-{connector}-{connectorId})
	Name string `json:"name"`
	// Data payload stored with each crawling job in the queue
	Data CrawlingJobData `json:"data"`
	// Job progress information (can be number 0-100 or object with percentage/current/total)
	Progress *ProgressUnion `json:"progress,omitempty"`
	// Delay in milliseconds before job starts (for delayed/scheduled jobs)
	Delay optionalnullable.OptionalNullable[int64] `json:"delay,omitempty"`
	// Unix timestamp when job was created (milliseconds)
	Timestamp int64 `json:"timestamp"`
	// Number of execution attempts made (increments on retry)
	AttemptsMade int64 `json:"attemptsMade"`
	// Unix timestamp when job completed (null if not finished)
	FinishedOn optionalnullable.OptionalNullable[int64] `json:"finishedOn,omitempty"`
	// Unix timestamp when job started processing (null if not started)
	ProcessedOn optionalnullable.OptionalNullable[int64] `json:"processedOn,omitempty"`
	// Error message if job failed
	FailedReason optionalnullable.OptionalNullable[string] `json:"failedReason,omitempty"`
	// Current state of the job in the queue:<br>
	// <ul>
	// <li><b>waiting</b>: Queued and waiting to be processed</li>
	// <li><b>active</b>: Currently being processed by a worker</li>
	// <li><b>completed</b>: Successfully finished</li>
	// <li><b>failed</b>: Failed after all retry attempts</li>
	// <li><b>delayed</b>: Scheduled to run at a future time</li>
	// <li><b>paused</b>: Manually paused by user</li>
	// <li><b>stuck</b>: Job is stuck (worker crashed mid-processing)</li>
	// </ul>
	//
	State State `json:"state"`
}

func (o *JobStatus) GetID() optionalnullable.OptionalNullable[string] {
	if o == nil {
		return nil
	}
	return o.ID
}

func (o *JobStatus) GetName() string {
	if o == nil {
		return ""
	}
	return o.Name
}

func (o *JobStatus) GetData() CrawlingJobData {
	if o == nil {
		return CrawlingJobData{}
	}
	return o.Data
}

func (o *JobStatus) GetProgress() *ProgressUnion {
	if o == nil {
		return nil
	}
	return o.Progress
}

func (o *JobStatus) GetDelay() optionalnullable.OptionalNullable[int64] {
	if o == nil {
		return nil
	}
	return o.Delay
}

func (o *JobStatus) GetTimestamp() int64 {
	if o == nil {
		return 0
	}
	return o.Timestamp
}

func (o *JobStatus) GetAttemptsMade() int64 {
	if o == nil {
		return 0
	}
	return o.AttemptsMade
}

func (o *JobStatus) GetFinishedOn() optionalnullable.OptionalNullable[int64] {
	if o == nil {
		return nil
	}
	return o.FinishedOn
}

func (o *JobStatus) GetProcessedOn() optionalnullable.OptionalNullable[int64] {
	if o == nil {
		return nil
	}
	return o.ProcessedOn
}

func (o *JobStatus) GetFailedReason() optionalnullable.OptionalNullable[string] {
	if o == nil {
		return nil
	}
	return o.FailedReason
}

func (o *JobStatus) GetState() State {
	if o == nil {
		return State("")
	}
	return o.State
}
