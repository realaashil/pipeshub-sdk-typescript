/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import * as z from "zod/v4-mini";
import { remap as remap$ } from "../lib/primitives.js";
import { safeParse } from "../lib/schemas.js";
import * as openEnums from "../types/enums.js";
import { OpenEnum } from "../types/enums.js";
import { Result as SafeParseResult } from "../types/fp.js";
import * as types from "../types/primitives.js";
import {
  CitationReference,
  CitationReference$inboundSchema,
} from "./citation-reference.js";
import { SDKValidationError } from "./errors/sdk-validation-error.js";
import {
  FollowUpQuestion,
  FollowUpQuestion$inboundSchema,
} from "./follow-up-question.js";
import {
  MessageFeedback,
  MessageFeedback$inboundSchema,
} from "./message-feedback.js";

/**
 * Type of message:
 *
 * @remarks
 * <ul>
 * <li><code>user_query</code> - User's question or input</li>
 * <li><code>bot_response</code> - AI-generated response</li>
 * <li><code>error</code> - Error message from the system</li>
 * <li><code>feedback</code> - User feedback on a response</li>
 * <li><code>system</code> - System notification or status</li>
 * </ul>
 */
export const MessageType = {
  UserQuery: "user_query",
  BotResponse: "bot_response",
  Error: "error",
  Feedback: "feedback",
  System: "system",
} as const;
/**
 * Type of message:
 *
 * @remarks
 * <ul>
 * <li><code>user_query</code> - User's question or input</li>
 * <li><code>bot_response</code> - AI-generated response</li>
 * <li><code>error</code> - Error message from the system</li>
 * <li><code>feedback</code> - User feedback on a response</li>
 * <li><code>system</code> - System notification or status</li>
 * </ul>
 */
export type MessageType = OpenEnum<typeof MessageType>;

/**
 * Format of the content for rendering
 */
export const ContentFormat = {
  Markdown: "MARKDOWN",
  Json: "JSON",
  Html: "HTML",
} as const;
/**
 * Format of the content for rendering
 */
export type ContentFormat = OpenEnum<typeof ContentFormat>;

export type MessageMetadata = {
  /**
   * Time taken to generate response in milliseconds
   */
  processingTimeMs?: number | undefined;
  /**
   * Version of the AI model used
   */
  modelVersion?: string | undefined;
  /**
   * Transaction ID for tracking in AI backend
   */
  aiTransactionId?: string | undefined;
  /**
   * Additional context or reasoning
   */
  reason?: string | undefined;
};

/**
 * A single message within a conversation. Messages can be user queries,
 *
 * @remarks
 * AI responses, system messages, or error notifications.
 */
export type Message = {
  /**
   * Unique message identifier
   */
  id?: string | undefined;
  /**
   * Type of message:
   *
   * @remarks
   * <ul>
   * <li><code>user_query</code> - User's question or input</li>
   * <li><code>bot_response</code> - AI-generated response</li>
   * <li><code>error</code> - Error message from the system</li>
   * <li><code>feedback</code> - User feedback on a response</li>
   * <li><code>system</code> - System notification or status</li>
   * </ul>
   */
  messageType?: MessageType | undefined;
  /**
   * The message text content
   */
  content?: string | undefined;
  /**
   * Format of the content for rendering
   */
  contentFormat: ContentFormat;
  /**
   * References to source documents used in the response
   */
  citations?: Array<CitationReference> | undefined;
  /**
   * AI's confidence level in the response
   */
  confidence?: string | undefined;
  /**
   * Suggested follow-up questions
   */
  followUpQuestions?: Array<FollowUpQuestion> | undefined;
  /**
   * User feedback on this message
   */
  feedback?: Array<MessageFeedback> | undefined;
  metadata?: MessageMetadata | undefined;
  createdAt?: Date | undefined;
  updatedAt?: Date | undefined;
};

/** @internal */
export const MessageType$inboundSchema: z.ZodMiniType<MessageType, unknown> =
  openEnums.inboundSchema(MessageType);

/** @internal */
export const ContentFormat$inboundSchema: z.ZodMiniType<
  ContentFormat,
  unknown
> = openEnums.inboundSchema(ContentFormat);

/** @internal */
export const MessageMetadata$inboundSchema: z.ZodMiniType<
  MessageMetadata,
  unknown
> = z.object({
  processingTimeMs: types.optional(types.number()),
  modelVersion: types.optional(types.string()),
  aiTransactionId: types.optional(types.string()),
  reason: types.optional(types.string()),
});

export function messageMetadataFromJSON(
  jsonString: string,
): SafeParseResult<MessageMetadata, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => MessageMetadata$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'MessageMetadata' from JSON`,
  );
}

/** @internal */
export const Message$inboundSchema: z.ZodMiniType<Message, unknown> = z.pipe(
  z.object({
    _id: types.optional(types.string()),
    messageType: types.optional(MessageType$inboundSchema),
    content: types.optional(types.string()),
    contentFormat: z._default(ContentFormat$inboundSchema, "MARKDOWN"),
    citations: types.optional(z.array(CitationReference$inboundSchema)),
    confidence: types.optional(types.string()),
    followUpQuestions: types.optional(z.array(FollowUpQuestion$inboundSchema)),
    feedback: types.optional(z.array(MessageFeedback$inboundSchema)),
    metadata: types.optional(z.lazy(() => MessageMetadata$inboundSchema)),
    createdAt: types.optional(types.date()),
    updatedAt: types.optional(types.date()),
  }),
  z.transform((v) => {
    return remap$(v, {
      "_id": "id",
    });
  }),
);

export function messageFromJSON(
  jsonString: string,
): SafeParseResult<Message, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => Message$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'Message' from JSON`,
  );
}
