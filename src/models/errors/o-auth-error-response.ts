/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import * as z from "zod/v4-mini";
import { remap as remap$ } from "../../lib/primitives.js";
import * as types from "../../types/primitives.js";
import * as models from "../index.js";
import { PipeshubError } from "./pipeshub-error.js";

/**
 * OAuth 2.0 Error Response (RFC 6749 Section 5.2).
 *
 * @remarks
 * Standard error format for OAuth endpoints.
 */
export type OAuthErrorResponseData = {
  /**
   * Error code. Common values:
   *
   * @remarks
   * - `invalid_request` - Missing or invalid parameter
   * - `invalid_client` - Client authentication failed
   * - `invalid_grant` - Invalid authorization code or refresh token
   * - `unauthorized_client` - Client not authorized for this grant type
   * - `unsupported_grant_type` - Grant type not supported
   * - `invalid_scope` - Requested scope is invalid or exceeds allowed
   * - `access_denied` - User denied authorization
   */
  error: models.ErrorT;
  /**
   * Human-readable error description
   */
  errorDescription?: string | undefined;
  /**
   * URI with more information about the error
   */
  errorUri?: string | undefined;
  /**
   * State parameter from the authorization request
   */
  state?: string | undefined;
};

/**
 * OAuth 2.0 Error Response (RFC 6749 Section 5.2).
 *
 * @remarks
 * Standard error format for OAuth endpoints.
 */
export class OAuthErrorResponse extends PipeshubError {
  /**
   * Error code. Common values:
   *
   * @remarks
   * - `invalid_request` - Missing or invalid parameter
   * - `invalid_client` - Client authentication failed
   * - `invalid_grant` - Invalid authorization code or refresh token
   * - `unauthorized_client` - Client not authorized for this grant type
   * - `unsupported_grant_type` - Grant type not supported
   * - `invalid_scope` - Requested scope is invalid or exceeds allowed
   * - `access_denied` - User denied authorization
   */
  error: models.ErrorT;
  /**
   * Human-readable error description
   */
  errorDescription?: string | undefined;
  /**
   * URI with more information about the error
   */
  errorUri?: string | undefined;
  /**
   * State parameter from the authorization request
   */
  state?: string | undefined;

  /** The original data that was passed to this error instance. */
  data$: OAuthErrorResponseData;

  constructor(
    err: OAuthErrorResponseData,
    httpMeta: { response: Response; request: Request; body: string },
  ) {
    const message = "message" in err && typeof err.message === "string"
      ? err.message
      : `API error occurred: ${JSON.stringify(err)}`;
    super(message, httpMeta);
    this.data$ = err;
    this.error = err.error;
    if (err.errorDescription != null) {
      this.errorDescription = err.errorDescription;
    }
    if (err.errorUri != null) this.errorUri = err.errorUri;
    if (err.state != null) this.state = err.state;

    this.name = "OAuthErrorResponse";
  }
}

/** @internal */
export const OAuthErrorResponse$inboundSchema: z.ZodMiniType<
  OAuthErrorResponse,
  unknown
> = z.pipe(
  z.object({
    error: models.ErrorT$inboundSchema,
    error_description: types.optional(types.string()),
    error_uri: types.optional(types.string()),
    state: types.optional(types.string()),
    request$: z.custom<Request>(x => x instanceof Request),
    response$: z.custom<Response>(x => x instanceof Response),
    body$: z.string(),
  }),
  z.transform((v) => {
    const remapped = remap$(v, {
      "error_description": "errorDescription",
      "error_uri": "errorUri",
    });

    return new OAuthErrorResponse(remapped, {
      request: v.request$,
      response: v.response$,
      body: v.body$,
    });
  }),
);
