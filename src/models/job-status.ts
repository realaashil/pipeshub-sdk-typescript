/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import * as z from "zod/v4-mini";
import { safeParse } from "../lib/schemas.js";
import * as openEnums from "../types/enums.js";
import { OpenEnum } from "../types/enums.js";
import { Result as SafeParseResult } from "../types/fp.js";
import * as types from "../types/primitives.js";
import { smartUnion } from "../types/smart-union.js";
import {
  CrawlingJobData,
  CrawlingJobData$inboundSchema,
} from "./crawling-job-data.js";
import { SDKValidationError } from "./errors/sdk-validation-error.js";

/**
 * Detailed progress object
 */
export type Progress = {
  percentage?: number | undefined;
  /**
   * Current items processed
   */
  current?: number | undefined;
  /**
   * Total items to process
   */
  total?: number | undefined;
};

/**
 * Job progress information (can be number 0-100 or object with percentage/current/total)
 */
export type ProgressUnion = number | Progress;

/**
 * Current state of the job in the queue:<br>
 *
 * @remarks
 * <ul>
 * <li><b>waiting</b>: Queued and waiting to be processed</li>
 * <li><b>active</b>: Currently being processed by a worker</li>
 * <li><b>completed</b>: Successfully finished</li>
 * <li><b>failed</b>: Failed after all retry attempts</li>
 * <li><b>delayed</b>: Scheduled to run at a future time</li>
 * <li><b>paused</b>: Manually paused by user</li>
 * <li><b>stuck</b>: Job is stuck (worker crashed mid-processing)</li>
 * </ul>
 */
export const State = {
  Waiting: "waiting",
  Active: "active",
  Completed: "completed",
  Failed: "failed",
  Delayed: "delayed",
  Paused: "paused",
  Stuck: "stuck",
} as const;
/**
 * Current state of the job in the queue:<br>
 *
 * @remarks
 * <ul>
 * <li><b>waiting</b>: Queued and waiting to be processed</li>
 * <li><b>active</b>: Currently being processed by a worker</li>
 * <li><b>completed</b>: Successfully finished</li>
 * <li><b>failed</b>: Failed after all retry attempts</li>
 * <li><b>delayed</b>: Scheduled to run at a future time</li>
 * <li><b>paused</b>: Manually paused by user</li>
 * <li><b>stuck</b>: Job is stuck (worker crashed mid-processing)</li>
 * </ul>
 */
export type State = OpenEnum<typeof State>;

/**
 * Complete status information for a crawling job
 */
export type JobStatus = {
  /**
   * Unique job ID assigned by BullMQ
   */
  id?: string | null | undefined;
  /**
   * Job name (format crawl-{connector}-{connectorId})
   */
  name: string;
  /**
   * Data payload stored with each crawling job in the queue
   */
  data: CrawlingJobData;
  /**
   * Job progress information (can be number 0-100 or object with percentage/current/total)
   */
  progress?: number | Progress | undefined;
  /**
   * Delay in milliseconds before job starts (for delayed/scheduled jobs)
   */
  delay?: number | null | undefined;
  /**
   * Unix timestamp when job was created (milliseconds)
   */
  timestamp: number;
  /**
   * Number of execution attempts made (increments on retry)
   */
  attemptsMade: number;
  /**
   * Unix timestamp when job completed (null if not finished)
   */
  finishedOn?: number | null | undefined;
  /**
   * Unix timestamp when job started processing (null if not started)
   */
  processedOn?: number | null | undefined;
  /**
   * Error message if job failed
   */
  failedReason?: string | null | undefined;
  /**
   * Current state of the job in the queue:<br>
   *
   * @remarks
   * <ul>
   * <li><b>waiting</b>: Queued and waiting to be processed</li>
   * <li><b>active</b>: Currently being processed by a worker</li>
   * <li><b>completed</b>: Successfully finished</li>
   * <li><b>failed</b>: Failed after all retry attempts</li>
   * <li><b>delayed</b>: Scheduled to run at a future time</li>
   * <li><b>paused</b>: Manually paused by user</li>
   * <li><b>stuck</b>: Job is stuck (worker crashed mid-processing)</li>
   * </ul>
   */
  state: State;
};

/** @internal */
export const Progress$inboundSchema: z.ZodMiniType<Progress, unknown> = z
  .object({
    percentage: types.optional(types.number()),
    current: types.optional(types.number()),
    total: types.optional(types.number()),
  });

export function progressFromJSON(
  jsonString: string,
): SafeParseResult<Progress, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => Progress$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'Progress' from JSON`,
  );
}

/** @internal */
export const ProgressUnion$inboundSchema: z.ZodMiniType<
  ProgressUnion,
  unknown
> = smartUnion([types.number(), z.lazy(() => Progress$inboundSchema)]);

export function progressUnionFromJSON(
  jsonString: string,
): SafeParseResult<ProgressUnion, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => ProgressUnion$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'ProgressUnion' from JSON`,
  );
}

/** @internal */
export const State$inboundSchema: z.ZodMiniType<State, unknown> = openEnums
  .inboundSchema(State);

/** @internal */
export const JobStatus$inboundSchema: z.ZodMiniType<JobStatus, unknown> = z
  .object({
    id: z.optional(z.nullable(types.string())),
    name: types.string(),
    data: CrawlingJobData$inboundSchema,
    progress: types.optional(
      smartUnion([types.number(), z.lazy(() => Progress$inboundSchema)]),
    ),
    delay: z.optional(z.nullable(types.number())),
    timestamp: types.number(),
    attemptsMade: types.number(),
    finishedOn: z.optional(z.nullable(types.number())),
    processedOn: z.optional(z.nullable(types.number())),
    failedReason: z.optional(z.nullable(types.string())),
    state: State$inboundSchema,
  });

export function jobStatusFromJSON(
  jsonString: string,
): SafeParseResult<JobStatus, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => JobStatus$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'JobStatus' from JSON`,
  );
}
