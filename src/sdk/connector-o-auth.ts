/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import { connectorOAuthGetAuthorizationUrl } from "../funcs/connector-o-auth-get-authorization-url.js";
import { connectorOAuthGetTokenFromCode } from "../funcs/connector-o-auth-get-token-from-code.js";
import { connectorOAuthHandleCallback } from "../funcs/connector-o-auth-handle-callback.js";
import { ClientSDK, RequestOptions } from "../lib/sdks.js";
import * as operations from "../models/operations/index.js";
import { unwrapAsync } from "../types/fp.js";

export class ConnectorOAuth extends ClientSDK {
  /**
   * Exchange authorization code for tokens (legacy)
   *
   * @remarks
   * Exchange a Google Workspace authorization code for access and refresh tokens.<br><br>
   * <b>Note:</b> This is a legacy endpoint specific to Google Workspace connectors.
   * For new integrations, use the standard OAuth flow via
   * <code>/connectors/{connectorId}/oauth/authorize</code> and the callback.<br><br>
   * <b>Flow:</b><br>
   * <ol>
   * <li>User completes Google Workspace OAuth consent in the browser</li>
   * <li>Browser receives authorization code</li>
   * <li>Frontend sends the code to this endpoint</li>
   * <li>Backend exchanges code for tokens and stores them</li>
   * </ol>
   * <b>Admin Only:</b> Requires admin privileges.
   */
  async getTokenFromCode(
    request: operations.GetTokenFromCodeRequest,
    options?: RequestOptions,
  ): Promise<operations.GetTokenFromCodeResponse> {
    return unwrapAsync(connectorOAuthGetTokenFromCode(
      this,
      request,
      options,
    ));
  }

  /**
   * Get OAuth authorization URL
   *
   * @remarks
   * Generate an OAuth authorization URL to start the OAuth flow.<br><br>
   * <b>Flow:</b><br>
   * <ol>
   * <li>Call this endpoint to get the authorization URL</li>
   * <li>Redirect user's browser to the URL</li>
   * <li>User authenticates with the provider</li>
   * <li>Provider redirects to callback with authorization code</li>
   * <li>Callback exchanges code for tokens automatically</li>
   * </ol>
   * <b>State Parameter:</b><br>
   * The response includes a <code>state</code> value that encodes the
   * connector ID. This is validated in the callback.
   */
  async getAuthorizationUrl(
    request: operations.GetOAuthAuthorizationUrlRequest,
    options?: RequestOptions,
  ): Promise<operations.GetOAuthAuthorizationUrlResponse> {
    return unwrapAsync(connectorOAuthGetAuthorizationUrl(
      this,
      request,
      options,
    ));
  }

  /**
   * OAuth callback handler
   *
   * @remarks
   * Handle the OAuth callback from the identity provider.<br><br>
   * <b>Note:</b><br>
   * This endpoint is called by the OAuth provider after user authentication.
   * The state parameter contains the encoded connector ID.<br><br>
   * <b>Success:</b><br>
   * On success, tokens are stored and the connector becomes authenticated.
   * User is redirected to the frontend success page.<br><br>
   * <b>Error:</b><br>
   * If the provider returns an error (e.g., user denied access),
   * user is redirected with error information.
   */
  async handleCallback(
    request?: operations.HandleOAuthCallbackRequest | undefined,
    options?: RequestOptions,
  ): Promise<operations.HandleOAuthCallbackResponse | undefined> {
    return unwrapAsync(connectorOAuthHandleCallback(
      this,
      request,
      options,
    ));
  }
}
